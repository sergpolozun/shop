{% extends "main/base.html" %}
{% load static %}
{% load mytags %}

{% block title %}Избранное | POLOS{% endblock %}

{% block content %}
<div class="shop-container">
  <div class="shop-header">
    <span>Избранные товары</span>
  </div>

  <!-- Навигационная панель -->
  <div class="shop-nav">
    <div class="shop-nav-left">
      <button class="btn-win98" onclick="window.location.href='{% url 'shop:product_list' %}'">В магазин</button>
    </div>
    
    <div class="shop-nav-center">
      {% if page_obj.has_other_pages %}
        <div class="pagination-info">
          <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
          <div class="pagination-controls">
            {% if page_obj.has_previous %}
              <button class="btn-win98" onclick="goToPage({{ page_obj.previous_page_number }})">←</button>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <span class="current-page">{{ num }}</span>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <button class="btn-win98" onclick="goToPage({{ num }})">{{ num }}</button>
              {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
              <button class="btn-win98" onclick="goToPage({{ page_obj.next_page_number }})">→</button>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
    
    <div class="shop-nav-right">
      <button class="btn-win98" onclick="window.location.href='{% url 'shop:favorite_list' %}'">Избранное</button>
      {% if user.is_authenticated %}
        <form method="post" action="{% url 'logout' %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn-win98">Выйти</button>
        </form>
        <button class="btn-win98" onclick="window.location.href='{% url 'shop:cart' %}'">Корзина</button>
      {% else %}
        <button class="btn-win98" onclick="window.location.href='{% url 'login' %}'">Войти</button>
      {% endif %}
    </div>
  </div>

  <!-- Список товаров -->
  <section class="product-list" aria-label="Список избранных товаров">
    {% for product in products %}
      <article class="product-card favorite-product" onclick="openProductModal({{ product.id }})">
        <div class="product-image">
        {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}">
        {% else %}
          <img src="{% static 'img/notfound.jpg' %}" alt="Изображение не найдено">
        {% endif %}
        </div>

        <div class="product-info">
          <h3>{{ product.name|truncatewords:3 }}</h3>
          <p class="product-date">Добавлено: {{ product.created_at|date:"d.m.Y" }}</p>

        {% if product.discount %}
            <div class="product-price">
            <span class="old-price">{{ product.price }}₽</span>
            <span class="discount-price">{{ product.discount_price }}₽</span>
              <span class="discount-badge">-{{ product.discount }}%</span>
            </div>
        {% else %}
            <div class="product-price">
              <span class="current-price">{{ product.price }}₽</span>
            </div>
        {% endif %}
        </div>
      </article>
    {% empty %}
      <div style="margin:40px 0;text-align:center;font-size:18px;">Нет избранных товаров</div>
    {% endfor %}
  </section>
</div>

<!-- Модальное окно товара -->
<div id="productModal" class="modal-win98">
    <div class="modal-content-win98">
        <div class="modal-header-win98">
            <h3 id="modalTitle">Детали товара</h3>
            <button class="close-btn-win98" onclick="closeProductModal()">×</button>
        </div>
        <div class="modal-body-win98" id="modalBody">
            <!-- Контент будет загружен через AJAX -->
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/list.js' %}"></script>
<script src="{% static 'js/cart.js' %}"></script>
{% endblock %} 